<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>æ‰€æœ‰ Emojiï¼ˆç‚¹å‡»å¤åˆ¶ï¼‰</title>
<style>
  :root{
    --bg: #0b0c0f;
    --fg: #e7e9ee;
    --muted: #98a2b3;
    --card: #111319;
    --accent: #4f8cff;
    --accent-2: #22c55e;
    --border: #1c2030;
  }
  @media (prefers-color-scheme: light){
    :root{
      --bg:#fafafa; --fg:#101828; --muted:#667085;
      --card:#ffffff; --accent:#1d4ed8; --accent-2:#16a34a; --border:#e5e7eb;
    }
  }
  *{box-sizing: border-box}
  html,body{height:100%}
  body{
    margin:0; background:var(--bg); color:var(--fg);
    font:14px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Noto Sans","Helvetica Neue",Arial,"Apple Color Emoji","Segoe UI Emoji";
  }
  header{
    position:sticky; top:0; z-index:10;
    backdrop-filter:saturate(150%) blur(6px);
    background:linear-gradient(180deg,rgba(0,0,0,.35),rgba(0,0,0,0)) , var(--bg);
    border-bottom:1px solid var(--border);
  }
  .wrap{max-width:1100px; margin:0 auto; padding:16px}
  h1{margin:0 0 6px 0; font-size:20px; letter-spacing:.2px}
  .controls{
    display:flex; gap:8px; flex-wrap:wrap; align-items:center;
  }
  .chip{
    padding:8px 10px; border:1px solid var(--border); background:var(--card);
    border-radius:10px; color:var(--muted); display:inline-flex; align-items:center; gap:8px;
  }
  .chip strong{color:var(--fg)}
  input[type="search"]{
    flex:1 1 260px; padding:10px 12px; border-radius:12px; border:1px solid var(--border);
    background:var(--card); color:var(--fg); outline:none;
  }
  .note{color:var(--muted); font-size:12px}
  main{max-width:1160px; margin:10px auto 60px; padding:0 16px}
  .group{margin:20px 0}
  .group h2{font-size:16px; margin:18px 0 10px 0; color:var(--muted); font-weight:600}
  .subgroup{margin:10px 0 14px 0}
  .subgroup h3{font-size:13px; margin:8px 0 8px 0; color:var(--muted); font-weight:600}
  .grid{
    display:grid; gap:8px;
    grid-template-columns: repeat(auto-fit, minmax(56px, 1fr));
  }
  button.emoji{
    appearance:none; border:none; border-radius:12px; cursor:pointer;
    background:var(--card); border:1px solid var(--border);
    min-height:64px; font-size:34px; line-height:1; display:flex; align-items:center; justify-content:center;
    transition:transform .05s ease, box-shadow .15s ease, border-color .2s ease;
    font-family: "Apple Color Emoji","Segoe UI Emoji",Noto Color Emoji,system-ui,Segoe UI,Roboto,Arial;
    user-select:none; -webkit-tap-highlight-color: transparent;
  }
  button.emoji:hover{transform:translateY(-1px)}
  button.emoji:active{transform:scale(.98)}
  button.emoji.copied{
    outline:2px solid var(--accent-2);
    box-shadow:0 0 0 3px color-mix(in oklab, var(--accent-2) 30%, transparent);
    border-color: color-mix(in oklab, var(--accent-2) 50%, var(--border));
  }
  .hr{height:1px; background:var(--border); margin:12px 0}
  .toast{
    position:fixed; right:14px; bottom:14px; z-index:20;
    background:var(--card); border:1px solid var(--border); color:var(--fg);
    padding:10px 12px; border-radius:12px; box-shadow:0 4px 16px rgba(0,0,0,.2);
    opacity:0; transform:translateY(8px); transition:opacity .2s, transform .2s;
    pointer-events:none; font-size:13px;
  }
  .toast.show{opacity:1; transform:translateY(0)}
  .skeleton{height:64px; border-radius:12px; background:linear-gradient(90deg, transparent, rgba(255,255,255,.06), transparent); border:1px solid var(--border); }
  footer{color:var(--muted); text-align:center; padding:30px 16px}
  a{color:var(--accent); text-decoration:none}
  .hidden{display:none !important}
</style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>æ‰€æœ‰ Emojiï¼ˆç‚¹å‡»å³å¯å¤åˆ¶ï¼‰</h1>
      <div class="controls">
        <input id="q" type="search" placeholder="æœç´¢åç§° / åˆ†ç»„ï¼ˆä¾‹å¦‚ï¼šheartã€æ——å¸œã€åŠ¨ç‰©â€¦ï¼‰" />
        <div class="chip" title="åªå±•ç¤ºæ ‡å‡†å½¢æ€ï¼ˆfully-qualifiedï¼‰">ç­›é€‰ï¼š<strong>Fully-qualified</strong></div>
        <div class="chip"><span id="countShown">0</span> / <span id="countAll">0</span></div>
      </div>
      <div class="note">æ•°æ®æ¥æºï¼šUnicode å®˜æ–¹ <code>emoji-test.txt / latest</code>ï¼ˆé¡µé¢åŠ è½½æ—¶å®æ—¶è·å–ï¼‰ã€‚</div>
    </div>
  </header>

  <main id="app" aria-live="polite">
    <div class="wrap" id="loading">
      <div class="hr"></div>
      <div class="grid" id="skeletons"></div>
    </div>
  </main>

  <div class="toast" id="toast">å·²å¤åˆ¶</div>

  <footer>
    <div>å¦‚æœç½‘ç»œå—é™æ— æ³•è·å–æ¸…å•ï¼Œè¯·åˆ·æ–°é‡è¯•ã€‚ç‚¹å‡»ä»»æ„ Emoji ä¼šå¤åˆ¶å­—ç¬¦æœ¬èº«ï¼ˆéçŸ­ç ï¼‰ã€‚</div>
  </footer>

<script>
(async function(){
  const SOURCE = "https://unicode.org/Public/emoji/latest/emoji-test.txt"; // å§‹ç»ˆæŒ‡å‘æœ€æ–°ç‰ˆæœ¬
  const app = document.getElementById('app');
  const toast = document.getElementById('toast');
  const q = document.getElementById('q');
  const countShown = document.getElementById('countShown');
  const countAll = document.getElementById('countAll');
  const skeletons = document.getElementById('skeletons');

  // æ¸²æŸ“ä¸€äº›éª¨æ¶å ä½
  (function renderSkeleton(){
    const frag = document.createDocumentFragment();
    for(let i=0;i<72;i++){
      const s = document.createElement('div');
      s.className = 'skeleton';
      frag.appendChild(s);
    }
    skeletons.appendChild(frag);
  })();

  const text = await fetchText(SOURCE);
  const { groups, allItems } = parseEmojiTest(text);

  // ç»Ÿè®¡
  countAll.textContent = String(allItems.length);

  // æŒ‰ç»„æ¸²æŸ“
  app.innerHTML = '';
  const wrap = document.createElement('div');
  wrap.className = 'wrap';
  app.appendChild(wrap);

  const emojiButtons = [];
  for (const g of groups){
    const gEl = document.createElement('section');
    gEl.className = 'group';
    const h2 = document.createElement('h2');
    h2.textContent = `ğŸ· ç»„ï¼š${g.name}`;
    gEl.appendChild(h2);

    for (const sg of g.subgroups){
      const sgEl = document.createElement('div');
      sgEl.className = 'subgroup';
      const h3 = document.createElement('h3');
      h3.textContent = `â€º ${sg.name}`;
      sgEl.appendChild(h3);

      const grid = document.createElement('div');
      grid.className = 'grid';
      const frag = document.createDocumentFragment();

      for (const item of sg.items){
        const btn = document.createElement('button');
        btn.className = 'emoji';
        btn.type = 'button';
        btn.textContent = item.emoji;
        btn.title = `${item.name} â€” ${g.name} / ${sg.name}`;
        btn.setAttribute('data-name', item.name.toLowerCase());
        btn.setAttribute('data-group', g.name.toLowerCase());
        btn.setAttribute('data-subgroup', sg.name.toLowerCase());
        btn.setAttribute('data-emoji', item.emoji);
        btn.addEventListener('click', onCopy);
        frag.appendChild(btn);
        emojiButtons.push(btn);
      }
      grid.appendChild(frag);
      sgEl.appendChild(grid);
      gEl.appendChild(sgEl);
    }
    wrap.appendChild(gEl);
  }

  // åˆå§‹è®¡æ•°
  updateShownCount();

  // æœç´¢è¿‡æ»¤
  q.addEventListener('input', () => {
    const term = q.value.trim().toLowerCase();
    for (const btn of emojiButtons){
      const match = !term || btn.dataset.name.includes(term) ||
        btn.dataset.group.includes(term) || btn.dataset.subgroup.includes(term) ||
        btn.dataset.emoji === term;
      btn.classList.toggle('hidden', !match);
    }
    updateShownCount();
  });

  // ç‚¹å‡»å¤åˆ¶
  async function onCopy(e){
    const btn = e.currentTarget;
    const emoji = btn.dataset.emoji;
    try{
      if (navigator.clipboard && window.isSecureContext){
        await navigator.clipboard.writeText(emoji);
      }else{
        // å…¼å®¹å›é€€
        const ta = document.createElement('textarea');
        ta.value = emoji;
        ta.style.position='fixed';
        ta.style.opacity='0';
        document.body.appendChild(ta);
        ta.focus(); ta.select();
        document.execCommand('copy');
        ta.remove();
      }
      flash(btn);
      showToast(`å·²å¤åˆ¶ï¼š${emoji}`);
    }catch(err){
      console.error(err);
      showToast('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
    }
  }

  function flash(el){
    el.classList.add('copied');
    setTimeout(()=>el.classList.remove('copied'), 500);
  }
  let toastTimer=null;
  function showToast(msg){
    toast.textContent = msg;
    toast.classList.add('show');
    clearTimeout(toastTimer);
    toastTimer = setTimeout(()=> toast.classList.remove('show'), 1400);
  }

  function updateShownCount(){
    const shown = emojiButtons.filter(b=>!b.classList.contains('hidden')).length;
    countShown.textContent = String(shown);
  }

  async function fetchText(url){
    const r = await fetch(url, {cache:'force-cache'});
    if (!r.ok) throw new Error('æ— æ³•è·å– Emoji æ¸…å•ï¼š' + r.status);
    return await r.text();
  }

  // è§£æ Unicode å®˜æ–¹ emoji-test.txt
  function parseEmojiTest(text){
    const lines = text.split(/\r?\n/);
    const groups = [];
    let currentGroup = null;
    let currentSub = null;
    const allItems = [];

    const pushGroup = name=>{
      currentGroup = { name, subgroups: [] };
      groups.push(currentGroup);
    };
    const pushSub = name=>{
      currentSub = { name, items: [] };
      currentGroup && currentGroup.subgroups.push(currentSub);
    };

    for (const raw of lines){
      const line = raw.trimEnd();
      if (!line || line.startsWith('#')) {
        if (line.startsWith('# group:')) {
          pushGroup(line.slice(8).trim().replace(/^:\s*/, '').trim());
        } else if (line.startsWith('# subgroup:')) {
          pushSub(line.slice(11).trim().replace(/^:\s*/, '').trim());
        }
        continue;
      }
      // å½¢å¦‚ï¼š "1F600 ; fully-qualified     # ğŸ˜€ grinning face"
      const parts = line.split('#');
      if (parts.length < 2) continue;
      const left = parts[0];
      const right = parts.slice(1).join('#'); // ä»¥é˜²åç§°é‡Œå†æœ‰ '#'

      const [cpAndSep, statusRaw] = left.split(';');
      if (!statusRaw) continue;
      const status = statusRaw.trim();
      if (status !== 'fully-qualified') continue;

      const cps = cpAndSep.trim().split(/\s+/).filter(Boolean);
      const codepoints = cps.map(hex => parseInt(hex, 16));
      const emojiStr = String.fromCodePoint(...codepoints);

      // å»æ‰æ³¨é‡Šé‡Œçš„å®é™…å­—ç¬¦ä¸å¯èƒ½å­˜åœ¨çš„ç‰ˆæœ¬å·å‰ç¼€ï¼ˆå¦‚ E15.1ï¼‰
      let name = right.trim();
      if (name.startsWith(emojiStr)) name = name.slice(emojiStr.length).trim();
      name = name.replace(/^E\d+(?:\.\d+)?\s*/,'').trim();
      // æŸäº›è¡Œæ ¼å¼ï¼š "ğŸ˜€ grinning face" -> ä»å¯èƒ½æ®‹ç•™å®é™…å­—ç¬¦
      if (name && name.charCodeAt(0) >= 0x2190 && name.charCodeAt(0) <= 0x1FAFF) {
        // ç®€å•å…œåº•ï¼šå¦‚æœç¬¬ä¸€ä¸ªå­—ç¬¦ä»åƒç¬¦å·ï¼Œè¿›ä¸€æ­¥æ¸…ç†
        name = name.replace(/^[^\p{Letter}\p{Number}]+/u,'').trim();
      }
      if (!name) name = cps.join(' ');

      const item = { emoji: emojiStr, name };
      if (currentSub) {
        currentSub.items.push(item);
        allItems.push(item);
      }
    }
    return { groups, allItems };
  }
})();
</script>
</body>
</html>